namespace = regentmaker
planet_event = {
	id = regentmaker.1
	title = "regentmaker.1"
	desc = "regentmaker.1.desc"
	picture = GFX_evt_throne_room
	is_triggered_only = yes
	immediate = {
		ROOT.owner = {
			save_global_event_target_as = decentralizer
			if = {
				limit = {
					NOT = { has_country_flag = first_alien_life }
				}
				set_country_flag = first_alien_life
				set_timed_country_flag = {
					flag = not_alien_life
					days = 10
				}
			}
			if = {
				limit = {
					NOT = { has_country_flag = has_encountered_other_empire }
				}
				set_country_flag = has_encountered_other_empire
				set_timed_country_flag = {
					flag = not_encountered_other_empire
					days = 10
				}
			}
		}
	}
	option = {
		name = "regentmaker.1.a"
		hidden_effect = {
			# set_timed_planet_flag = { flag = regentmaker_vassal days = 10 }
			remove_planet_flag = regentmaker_tributary
			remove_planet_flag = regentmaker_member_state
			planet_event = { id = regentmaker.2 }
		}
	}
	option = {
		name = "regentmaker.1.b"
		hidden_effect = {
			set_timed_planet_flag = {
				flag = regentmaker_tributary
				days = 7
			}
			# remove_planet_flag = regentmaker_vassal
			remove_planet_flag = regentmaker_member_state
			planet_event = { id = regentmaker.2 }
		}
	}
	option = {
		name = "regentmaker.1.c"
		trigger = {
			event_target:decentralizer = { has_modifier = decentralized_leader }
		}
		hidden_effect = {
			set_timed_planet_flag = {
				flag = regentmaker_member_state
				days = 7
			}
			# remove_planet_flag = regentmaker_vassal
			remove_planet_flag = regentmaker_tributary
			planet_event = { id = regentmaker.2 }
		}
	}
	option = {
		name = distar.1055.b		# "Leave it be."
		hidden_effect = {
			owner = {
				every_owned_planet = {
					limit = { has_planet_flag = regentmaker_handover }
					remove_planet_flag = regentmaker_handover
				}
			}
		}
	}
}

planet_event = {
	id = regentmaker.2
	title = "regentmaker.1"
	desc = "regentmaker.2.desc"
	picture = GFX_evt_throne_room
	is_triggered_only = yes
	option = {
		name = "regentmaker.2.a"
		hidden_effect = {
			owner_species = { save_event_target_as = vassal_species }
			# owner = { random_owned_planet = { limit = { has_planet_flag = regentmaker_handover }
			planet_event = { id = regentmaker.3 }
			#	} }
		}
	}
	option = {
		name = "regentmaker.2.b"
		hidden_effect = {
			if = {
				limit = { exists = event_target:vassal_species }
				no_scope = { save_event_target_as = vassal_species }
			}
			# owner = { random_owned_planet = { limit = { has_planet_flag = regentmaker_handover }
			planet_event = { id = regentmaker.3 }
			# } }
		}
	}
	option = {
		# "Leave it be."
		name = distar.1055.b
		hidden_effect = {
			owner = {
				every_owned_planet = {
					limit = { has_planet_flag = regentmaker_handover }
					remove_planet_flag = regentmaker_handover
				}
			}
		}
	}
}

planet_event = {
	id = regentmaker.3
	location = ROOT
	hide_window = yes
	is_triggered_only = yes
	# pre_triggers = {
	#	has_owner = yes
	#	is_ai = no
	# }
	# trigger = { #	owner = { any_owned_planet = { has_planet_flag = regentmaker_handover } }
	# }
	immediate = {
		## Save target species
		get_vassal_species = yes
		create_country = {
			# name = random
			name = "[This.GetStarName]"
			name_list = event_target:decentralizer
			type = default
			ship_prefix = ""
			government_restrictions = {
				authority = {
					NOR = { value = auth_machine_intelligence value = auth_hive_mind }
				}
			}
			authority = event_target:decentralizer
			civics = random
			ignore_initial_colony_error = yes
			randomize_ethos = yes
			ethos = random
			species = event_target:vassal_species
			flag = random			# separate color definition not possible!?
			origin = origin_hegemon_npc # origin_default
			# auto_delete = yes
			day_zero_contact = no
			exclude_day_zero_contact = event_target:decentralizer
			effect = {
				set_country_flag = first_alien_life
				set_country_flag = has_encountered_other_empire
				# change_country_flag = { }
				set_timed_relation_flag = {
					who = event_target:decentralizer
					flag = AbandonedRefugees
					days = 5
				}
				event_target:decentralizer = {
					set_timed_relation_flag = {
						who = prev
						flag = AbandonedRefugees
						days = 5
					}
				}
				establish_communications_no_message = event_target:decentralizer
				add_resource = {
					minerals = 500
					energy = 1000
					unity = 10000
					influence = 500
				}
				if = {
					limit = {
						ROOT = { has_planet_flag = regentmaker_tributary }
					}
					set_subject_of = {
						who = event_target:decentralizer
						subject_type = tributary
					}
				}
				else_if = {
					limit = {
						ROOT = { has_planet_flag = regentmaker_member_state }
					}
					set_subject_of = {
						who = event_target:decentralizer
						subject_type = member_state
					}
					add_intel = {
						who = event_target:decentralizer
						amount = 60
					}
				}
				else = {
					set_subject_of = {
						who = event_target:decentralizer
						subject_type = vassal
					}
				}
				set_faction_hostility = {
					set_hostile = no
					set_neutral = no
					set_friendly = yes
					target = event_target:decentralizer
				}
				# action_open_borders
				set_closed_borders = {
					who = event_target:decentralizer
					status = no
					forced = 5
				}
				# TODO test
				# change_dominant_species = { species = event_target:vassal_species change_all = yes } is still buggy 3.0.3
				event_target:decentralizer = {
					set_country_flag = has_communications@prev
					set_faction_hostility = {
						set_hostile = no
						set_neutral = no
						set_friendly = yes
						target = prev
					}
					every_federation_ally = { establish_communications = prevprev }
					every_relation = {
						establish_communications_no_message = last_created_country
						# establish_contact = { who = last_created_country location = ROOT }
					}
					# action_open_borders
					set_closed_borders = {
						who = prev
						status = no
						forced = 5
					}
				}
				establish_communications_no_message = event_target:decentralizer
				# establish_contact = { who = event_target:decentralizer location = event_target:decentralizer.capital_scope }
				copy_techs_from = {
					target = event_target:decentralizer
					except = {
						# Horizon Signal
						tech_akx_worm_1
						tech_akx_worm_2
						tech_akx_worm_3
					}
				}
				if = {
					limit = { is_same_species = event_target:decentralizer }
					random = {
						chance = 50
						copy_ethos_and_authority = event_target:decentralizer
						change_government = {
							authority = auth_imperial
							remove_invalid_civics = yes cooldown = no
							civics = {
								civic = random
								civic = random
								civic = random
							}
						}
					}
				}
				# else_if = { # name = random
				# limit = { NOT = { is_same_species = event_target:decentralizer } }
				# 	random_list = {
				# 		1 = {
				# 			set_name = "[This.GetStarName] $country$"
				# 		}
				# 		40 = {
				# 			set_name = "[This.GetStarName]"
				# 		}
				# 		1 = {
				# 			set_name = "[This.owner_species.GetName] $country$"
				# 		}
				# 		8 = {
				# 			modifier = {
				# 				factor = 0
				# 				is_homeworld = yes
				# 			}
				# 		}
				# 	}
				# }
				if = {
					limit = {
						FROM = { has_planet_flag = regentmaker_handover }
					}
					log = "Release selected planet [From.GetName]!"
					FROM = {
						planet_event = { id = regentmaker.9 }
					}
				}
				add_opinion_modifier = {
					who = event_target:decentralizer
					modifier = opinion_scion
				}
				add_opinion_modifier = {
					who = event_target:decentralizer
					modifier = opinion_ceded_starbase					# opinion_trust
				}
				add_opinion_modifier = {
					who = event_target:decentralizer
					modifier = opinion_enlightened_us					# opinion_common_ground
				}
				if = {
					limit = {
						exists = event_target:vassal_leader
						event_target:vassal_leader = {
							NOT = { leader_class = ruler }
						}
					}
					# sector = {
					log = "New leader [vassal_leader.GetName]"
					event_target:vassal_leader = { set_owner = prev }
					assign_leader = event_target:vassal_leader
					no_scope = { save_event_target_as = vassal_leader }					# remove only for sure
				}
				# create_starting_leaders = yes
				country_event = { id = decentralized.209 }				# create_starting_fleets = yes
			}
		}
		# last_created_country = {}
		event_target:decentralizer = {
			every_owned_planet = {
				limit = {
					has_planet_flag = regentmaker_handover
					# has_owner = yes
					# is_homeworld = no
					# original_owner = yes
					has_ground_combat = no
					is_capital = no
					is_occupied_flag = no
				}
				# log = "Release planet [This.GetName]!"
				planet_event = { id = regentmaker.9 }
			}
			establish_communications_no_message = last_created_country
			# establish_contact = { who = last_created_country location = ROOT }
			add_intel = {
				who = last_created_country
				amount = 50
			}
			if = {
				limit = { has_country_flag = not_encountered_other_empire }
				remove_country_flag = has_encountered_other_empire
			}
			if = {
				limit = { has_country_flag = not_alien_life }
				remove_country_flag = first_alien_life
			}
		}
	}
}

country_event = {
	id = regentmaker.4
	title = "regentmaker.4"
	desc = "regentmaker.4.desc"
	picture = GFX_evt_throne_room
	is_triggered_only = yes
	option = {
		name = "regentmaker.4.a"
		allow = {
			hidden_trigger = { has_resource = { type = influence amount > 49 } }
		}
		hidden_effect = {
			every_subject = {
				limit = { is_country_type = default }
				copy_techs_from = { target = root }
			}
		}
		add_resource = { influence = -50 }
	}
	option = {
		name = "regentmaker.4.b"
		allow = {
			hidden_trigger = { has_resource = { type = influence amount > 99 } }
		}
		hidden_effect = {
			every_subject = {
				limit = { is_country_type = default }
				root = {
					copy_techs_from = { target = prev }
				}
			}
		}
		add_resource = { influence = -100 }
	}
	# "Leave it be." tech_unlocked_ratio
	option = { name = distar.1055.b }
}

# "Regentmaker Ethics Selection"
country_event = {
	id = regentmaker.7
	title = "regentmaker.7"
	desc = "regentmaker.7.desc"
	picture = GFX_evt_throne_room
	is_triggered_only = yes
	# hide_window = yes
	# immediate = {
	# }
	option = {
		name = "regentmaker.7.a"
		country_event = { id = regentmaker.50 }
	}
	option = {
		name = "regentmaker.7.b"
		country_event = { id = regentmaker.500 }
	}
	option = {
		name = leviathans.105.d		# "Nothing for now. Goodbye."
	}
}

# "Regentmaker Government Selection"
country_event = {
	id = regentmaker.8
	title = "regentmaker.8"
	desc = "regentmaker.8.desc"
	picture = GFX_evt_throne_room
	is_triggered_only = yes
	# hide_window = yes
	# immediate = {}
	option = {
		name = "regentmaker.8.a"
		country_event = { id = regentmaker.51 }
	}
	option = {
		name = "regentmaker.8.b"
		country_event = { id = regentmaker.501 }
	}
	option = {
		name = leviathans.105.d		# "Nothing for now. Goodbye."
	}
}

# Release planet
planet_event = {
	id = regentmaker.9
	is_triggered_only = yes
	hide_window = yes
	immediate = {
		set_controller = last_created_country
		set_owner = last_created_country
		remove_planet_flag = regentmaker_handover
		solar_system = {
			if = {
				limit = { exists = starbase }
				starbase = { set_owner = last_created_country }
			}
			every_neighbor_system = {
				limit = {
					exists = starbase
					is_owned_by = event_target:decentralizer
				}
				if = {
					limit = {
						any_system_planet = {
							# has_owner = yes
							# owner = { is_same_empire = event_target:decentralizer }
							is_owned_by = event_target:decentralizer
							has_planet_flag = regentmaker_handover
						}
					}
					starbase = { set_owner = last_created_country }
					every_system_planet = {
						limit = {
							# has_owner = yes
							# owner = { is_same_empire = event_target:decentralizer }
							is_owned_by = event_target:decentralizer
							NOT = { is_same_value = prevprev }
						}
						if = {
							limit = { has_planet_flag = regentmaker_handover }
							remove_planet_flag = regentmaker_handover
							set_controller = last_created_country
							set_owner = last_created_country
						}
						else = {
							starbase = { set_owner = event_target:decentralizer }
						}
					}
				}
				else_if = {
					limit = {
						NOT = {
							any_system_planet = {
								is_star = no
								is_asteroid = no
								has_owner = yes
							}
						}
					}
					starbase = { set_owner = last_created_country }
				}
				# else = { }
			}
			every_system_planet = {
				limit = {
					is_star = no
					is_asteroid = no
					# has_owner = yes
					is_owned_by = event_target:decentralizer
					# owner = {
					#	is_same_empire = event_target:decentralizer
					# }
					NOT = { is_same_value = prevprev }
				}
				if = {
					limit = { has_planet_flag = regentmaker_handover }
					remove_planet_flag = regentmaker_handover
				}
				set_controller = last_created_country
				set_owner = last_created_country
			}
		}
		last_created_country = {
			add_resource = {
				minerals = 250
				energy = 500
			}
			capital_scope = {
				add_modifier = { modifier = "regentmaker_colony" days = -1 }
			}
		}
	}
}

# Set Mod Flag
event = {
	id = regentmaker.10
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		set_global_flag = gf_regentmaker_active
	}
}

# "Regentmaker Global Ethics Selection"
country_event = {
	id = regentmaker.50
	title = "regentmaker.7"
	desc = "regentmaker.7.desc"
	picture = GFX_evt_throne_room
	is_triggered_only = yes
	# immediate = {
	#	random_subject = {
	#		save_event_target_as = vassal_empire
	#	}
	# }
	option = {
		name = "regentmaker.50.a"
		every_subject = {
			limit = { is_subject_type = member_state }
			clear_ethos = yes
		}
	}
	option = {
		name = "ethic_fanatic_authoritarian"
		every_subject = {
			limit = { is_subject_type = member_state NOT = { has_ethic = ethic_fanatic_authoritarian } }
			shift_ethic = ethic_fanatic_authoritarian
		}
	}
	option = {
		name = "ethic_authoritarian"
		every_subject = {
			limit = { is_subject_type = member_state NOT = { has_ethic = ethic_authoritarian } }
			shift_ethic = ethic_authoritarian
		}
	}
	option = {
		name = "ethic_fanatic_egalitarian"
		every_subject = {
			limit = { is_subject_type = member_state NOT = { has_ethic = ethic_fanatic_egalitarian } }
			shift_ethic = ethic_fanatic_egalitarian
		}
	}
	option = {
		name = "ethic_egalitarian"
		every_subject = {
			limit = { is_subject_type = member_state NOT = { has_ethic = ethic_egalitarian } }
			shift_ethic = ethic_egalitarian
		}
	}
	option = {
		name = "ethic_fanatic_xenophobe"
		every_subject = {
			limit = { is_subject_type = member_state NOT = { has_ethic = ethic_fanatic_xenophobe } }
			shift_ethic = ethic_fanatic_xenophobe
		}
	}
	option = {
		name = "ethic_xenophobe"
		every_subject = {
			limit = { is_subject_type = member_state NOT = { has_ethic = ethic_xenophobe } }
			shift_ethic = ethic_xenophobe
		}
	}
	option = {
		name = "ethic_fanatic_xenophile"
		every_subject = {
			limit = { is_subject_type = member_state NOT = { has_ethic = ethic_fanatic_xenophile } }
			shift_ethic = ethic_fanatic_xenophile
		}
	}
	option = {
		name = "ethic_xenophile"
		every_subject = {
			limit = { is_subject_type = member_state NOT = { has_ethic = ethic_xenophile } }
			shift_ethic = ethic_xenophile
		}
	}
	option = {
		name = "ethic_fanatic_militarist"
		every_subject = {
			limit = { is_subject_type = member_state NOT = { has_ethic = ethic_fanatic_militarist } }
			shift_ethic = ethic_fanatic_militarist
		}
	}
	option = {
		name = "ethic_militarist"
		every_subject = {
			limit = { is_subject_type = member_state NOT = { has_ethic = ethic_militarist } }
			shift_ethic = ethic_militarist
		}
	}
	option = {
		name = "ethic_fanatic_pacifist"
		every_subject = {
			limit = { is_subject_type = member_state NOT = { has_ethic = ethic_fanatic_pacifist } }
			shift_ethic = ethic_fanatic_pacifist
		}
	}
	option = {
		name = "ethic_pacifist"
		every_subject = {
			limit = { is_subject_type = member_state NOT = { has_ethic = ethic_pacifist } }
			shift_ethic = ethic_pacifist
		}
	}
	option = {
		name = "ethic_fanatic_spiritualist"
		every_subject = {
			limit = { is_subject_type = member_state NOT = { has_ethic = ethic_fanatic_spiritualist } }
			shift_ethic = ethic_fanatic_spiritualist
		}
	}
	option = {
		name = "ethic_spiritualist"
		every_subject = {
			limit = { is_subject_type = member_state NOT = { has_ethic = ethic_spiritualist } }
			shift_ethic = ethic_spiritualist
		}
	}
	option = {
		name = "ethic_fanatic_materialist"
		every_subject = {
			limit = { is_subject_type = member_state NOT = { has_ethic = ethic_fanatic_materialist } }
			shift_ethic = ethic_fanatic_materialist
		}
	}
	option = {
		name = "ethic_materialist"
		every_subject = {
			limit = { is_subject_type = member_state NOT = { has_ethic = ethic_materialist } }
			shift_ethic = ethic_materialist
		}
	}
	# option = { # not wanted side effects
	#	name = "ethic_gestalt_consciousness"
	#	every_subject = { shift_ethic = ethic_gestalt_consciousness }
	# }
	option = {
		name = BACK
		# hidden_effect = {
		# 	no_scope = { save_event_target_as = vassal_empire }
		# }
	}
	after = {
		hidden_effect = {
			country_event = { id = regentmaker.7 }
		}
	}
	# after = {
	#	hidden_effect = {
	#		if = {
	#			limit = {
	#				exists = event_target:vassal_empire
	#				is_scope_type = country
	#			}
	#			every_subject = {
	#				limit = {
	#					NOR = {
	#						is_same_empire = event_target:vassal_empire
	#						has_same_ethos = event_target:vassal_empire
	#					}
	#				}
	#				copy_ethos_and_authority = event_target:vassal_empire
	#				# shift_ethic = event_target:vassal_empire
	#			}
	#		}
	#	}
	# }
}

# "Regentmaker Global Government Selection"
country_event = {
	id = regentmaker.51
	title = "regentmaker.8"
	desc = "regentmaker.8.desc"
	picture = GFX_evt_throne_room
	is_triggered_only = yes
	# immediate = {
	#	random_subject = {
	#		limit = { is_subject_type = member_state }
	#		save_event_target_as = vassal_empire
	#	}
	# }
	option = {
		name = "regentmaker_auth_democratic"
		every_subject = {
			limit = {
				NOT = { has_authority = auth_democratic }
				is_subject_type = member_state
			}
			set_timed_country_flag = { flag = auth_democratic days = 1 }
			country_event = { id = regentmaker.30 }
			change_government = { authority = auth_democratic civics = random remove_invalid_civics = yes cooldown = no }
		}
	}
	option = {
		name = SEPARATOR
		allow = { hidden_trigger = { always = no } }
	}
	option = {
		name = "regentmaker_auth_oligarchic"
		every_subject = {
			limit = {
				NOT = { has_authority = auth_oligarchic }
				is_subject_type = member_state
			}
			set_timed_country_flag = { flag = auth_oligarchic days = 1 }
			country_event = { id = regentmaker.30 }
			change_government = { authority = auth_oligarchic civics = random remove_invalid_civics = yes cooldown = no }
		}
	}
	option = {
		name = SEPARATOR
		allow = { hidden_trigger = { always = no } }
	}
	option = {
		name = "regentmaker_auth_dictatorial"
		every_subject = {
			limit = {
				NOT = { has_authority = auth_dictatorial }
				is_subject_type = member_state
			}
			set_timed_country_flag = { flag = auth_dictatorial days = 1 }
			country_event = { id = regentmaker.30 }
			change_government = { authority = auth_dictatorial civics = random remove_invalid_civics = yes cooldown = no }
		}
	}
	option = {
		name = SEPARATOR
		allow = { hidden_trigger = { always = no } }
	}
	option = {
		name = "regentmaker_auth_imperial"
		every_subject = {
			limit = {
				NOT = { has_authority = auth_imperial }
				is_subject_type = member_state
			}
			set_timed_country_flag = { flag = auth_imperial days = 1 }
			country_event = { id = regentmaker.30 }
			change_government = { authority = auth_imperial civics = random remove_invalid_civics = yes cooldown = no }
		}
	}
	option = {
		name = SEPARATOR
		allow = { hidden_trigger = { always = no } }
	}
	option = {
		name = "regentmaker_auth_corporate"
		every_subject = {
			limit = {
				NOT = { has_authority = auth_corporate }
				is_subject_type = member_state
			}
			set_timed_country_flag = { flag = auth_corporate days = 1 }
			country_event = { id = regentmaker.30 }
			change_government = { authority = auth_corporate civics = random remove_invalid_civics = yes cooldown = no }
		}
	}
	# option = { # not wanted
	#	name = "auth_hive_mind"
	#	every_subject = {
	#		change_government = { authority = auth_hive_mind civics = random remove_invalid_civics = yes cooldown = no }
	#	}
	# }
	# option = { # not wanted
	#	name = "auth_machine_intelligence"
	#	every_subject = {
	#		change_government = { authority = auth_machine_intelligence civics = random remove_invalid_civics = yes cooldown = no }
	#	}
	# }
	option = {
		name = BACK
		# hidden_effect = {
		# 	no_scope = { save_event_target_as = vassal_empire }
		# }
	}
	after = {
		hidden_effect = {
			country_event = { id = regentmaker.8 }
		}
	}
	# after = {
	#	hidden_effect = {
	#		if = {
	#			limit = {
	#				exists = event_target:vassal_empire
	#				is_scope_type = country
	#			}
	#			every_subject = {
	#				limit = {
	#					NOT = {
	#						is_same_empire = event_target:vassal_empire
	#					}
	#				}
	#				copy_ethos_and_authority = event_target:vassal_empire
	#				# change_government = {
	#				#	authority = event_target:vassal_empire
	#				#	# civics = random
	#				# }
	#			}
	#		}
	#	}
	# }
}

# has_global_flag = gf_moreauthorities_activated
# has_global_flag = cultural_overhaul_active
# has_global_flag = gf_veru_activated (Vassals Expanded and Reworked)
####################
# Find Subjects - Ethics
country_event = {
	id = regentmaker.500
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		set_variable = { which = rm_total_subjects value = 0 }
		# Count how many valid Subject States there are
		every_subject = {
			# count < 11
			limit = {
				is_country_type = default
				NOT = { is_subject_type = devstate }				# comp. Civil Wars mod
			}
			set_country_flag = subject_ethic_change
			overlord = {
				change_variable = { which = rm_total_subjects value = 1 }
			}
		}
		# Next, we save each subject as an Event Target
		# As the scripting language doesn't have proper loops, we use a lot of ifs and hope no one ever has more than 10 subjects.
		if = {
			limit = {
				check_variable = { which = rm_total_subjects value >= 1 }
			}
			random_subject = {
				limit = { has_country_flag = subject_ethic_change }
				remove_country_flag = subject_ethic_change
				save_event_target_as = subject_1
			}
		}
		if = {
			limit = {
				check_variable = { which = rm_total_subjects value >= 2 }
			}
			random_subject = {
				limit = { has_country_flag = subject_ethic_change }
				remove_country_flag = subject_ethic_change
				save_event_target_as = subject_2
			}
		}
		if = {
			limit = {
				check_variable = { which = rm_total_subjects value >= 3 }
			}
			random_subject = {
				limit = { has_country_flag = subject_ethic_change }
				remove_country_flag = subject_ethic_change
				save_event_target_as = subject_3
			}
		}
		if = {
			limit = {
				check_variable = { which = rm_total_subjects value >= 4 }
			}
			random_subject = {
				limit = { has_country_flag = subject_ethic_change }
				remove_country_flag = subject_ethic_change
				save_event_target_as = subject_4
			}
		}
		if = {
			limit = {
				check_variable = { which = rm_total_subjects value >= 5 }
			}
			random_subject = {
				limit = { has_country_flag = subject_ethic_change }
				remove_country_flag = subject_ethic_change
				save_event_target_as = subject_5
			}
		}
		if = {
			limit = {
				check_variable = { which = rm_total_subjects value >= 6 }
			}
			random_subject = {
				limit = { has_country_flag = subject_ethic_change }
				remove_country_flag = subject_ethic_change
				save_event_target_as = subject_6
			}
		}
		if = {
			limit = {
				check_variable = { which = rm_total_subjects value >= 7 }
			}
			random_subject = {
				limit = { has_country_flag = subject_ethic_change }
				remove_country_flag = subject_ethic_change
				save_event_target_as = subject_7
			}
		}
		if = {
			limit = {
				check_variable = { which = rm_total_subjects value >= 8 }
			}
			random_subject = {
				limit = { has_country_flag = subject_ethic_change }
				remove_country_flag = subject_ethic_change
				save_event_target_as = subject_8
			}
		}
		if = {
			limit = {
				check_variable = { which = rm_total_subjects value >= 9 }
			}
			random_subject = {
				limit = { has_country_flag = subject_ethic_change }
				remove_country_flag = subject_ethic_change
				save_event_target_as = subject_9
			}
		}
		if = {
			limit = {
				check_variable = { which = rm_total_subjects value >= 10 }
			}
			random_subject = {
				limit = { has_country_flag = subject_ethic_change }
				remove_country_flag = subject_ethic_change
				save_event_target_as = subject_10
			}
		}
	}
	after = {
		country_event = { id = regentmaker.502 }
	}
}

# Find Subjects - Government Selection
country_event = {
	id = regentmaker.501
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		set_variable = { which = rm_total_subjects value = 0 }
		# Count how many valid Subject States there are
		every_subject = {
			limit = {
				is_country_type = default
				NOT = { is_subject_type = devstate }		# comp. Civil Wars mod
			}
			set_country_flag = subject_gov_change
			overlord = {
				change_variable = { which = rm_total_subjects value = 1 }
			}
		}
		# Next, we save each subject as an Event Target
		# As the scripting language doesn't have proper loops, we use a lot of ifs and hope no one ever has more than 10 subjects.
		if = {
			limit = {
				check_variable = { which = rm_total_subjects value >= 1 }
			}
			random_subject = {
				limit = { has_country_flag = subject_gov_change }
				remove_country_flag = subject_gov_change
				save_event_target_as = subject_1
			}
		}
		if = {
			limit = {
				check_variable = { which = rm_total_subjects value >= 2 }
			}
			random_subject = {
				limit = { has_country_flag = subject_gov_change }
				remove_country_flag = subject_gov_change
				save_event_target_as = subject_2
			}
		}
		if = {
			limit = {
				check_variable = { which = rm_total_subjects value >= 3 }
			}
			random_subject = {
				limit = { has_country_flag = subject_gov_change }
				remove_country_flag = subject_gov_change
				save_event_target_as = subject_3
			}
		}
		if = {
			limit = {
				check_variable = { which = rm_total_subjects value >= 4 }
			}
			random_subject = {
				limit = { has_country_flag = subject_gov_change }
				remove_country_flag = subject_gov_change
				save_event_target_as = subject_4
			}
		}
		if = {
			limit = {
				check_variable = { which = rm_total_subjects value >= 5 }
			}
			random_subject = {
				limit = { has_country_flag = subject_gov_change }
				remove_country_flag = subject_gov_change
				save_event_target_as = subject_5
			}
		}
		if = {
			limit = {
				check_variable = { which = rm_total_subjects value >= 6 }
			}
			random_subject = {
				limit = { has_country_flag = subject_gov_change }
				remove_country_flag = subject_gov_change
				save_event_target_as = subject_6
			}
		}
		if = {
			limit = {
				check_variable = { which = rm_total_subjects value >= 7 }
			}
			random_subject = {
				limit = { has_country_flag = subject_gov_change }
				remove_country_flag = subject_gov_change
				save_event_target_as = subject_7
			}
		}
		if = {
			limit = {
				check_variable = { which = rm_total_subjects value >= 8 }
			}
			random_subject = {
				limit = { has_country_flag = subject_gov_change }
				remove_country_flag = subject_gov_change
				save_event_target_as = subject_8
			}
		}
		if = {
			limit = {
				check_variable = { which = rm_total_subjects value >= 9 }
			}
			random_subject = {
				limit = { has_country_flag = subject_gov_change }
				remove_country_flag = subject_gov_change
				save_event_target_as = subject_9
			}
		}
		if = {
			limit = {
				check_variable = { which = rm_total_subjects value >= 10 }
			}
			random_subject = {
				limit = { has_country_flag = subject_gov_change }
				remove_country_flag = subject_gov_change
				save_event_target_as = subject_10
			}
		}
	}
	after = {
		country_event = { id = regentmaker.503 }
	}
}

# List Subjects - Ethics Selection
country_event = {
	id = regentmaker.502
	title = rm.2.name
	desc = {
		trigger = {
			check_variable = { which = rm_total_subjects value > 0 }
		}
		text = rm.2.desc
	}
	desc = {
		trigger = {
			check_variable = { which = rm_total_subjects value = 0 }
		}
		text = rm.2.desc.fail
	}
	picture = GFX_evt_board_meeting
	show_sound = event_laboratory_sound
	location = ROOT
	is_triggered_only = yes
	# No valid target
	option = {
		name = "UNFORTUNATE"
		exclusive_trigger = {
			check_variable = { which = rm_total_subjects value = 0 }
		}
	}
	# Now we show a list of the subject states to the player
	option = {
		name = rm.2.subject_1
		custom_tooltip = rm.2.subject_1.tooltip
		trigger = {
			check_variable = { which = rm_total_subjects value >= 1 }
		}
		hidden_effect = {
			ROOT = {
				event_target:subject_1 = { save_event_target_as = subject_selected }
				country_event = { id = regentmaker.60 }
			}
		}
	}
	option = {
		name = rm.2.subject_2
		custom_tooltip = rm.2.subject_2.tooltip
		trigger = {
			check_variable = { which = rm_total_subjects value >= 2 }
		}
		hidden_effect = {
			ROOT = {
				event_target:subject_2 = { save_event_target_as = subject_selected }
				country_event = { id = regentmaker.60 }
			}
		}
	}
	option = {
		name = rm.2.subject_3
		custom_tooltip = rm.2.subject_3.tooltip
		trigger = {
			check_variable = { which = rm_total_subjects value >= 3 }
		}
		hidden_effect = {
			ROOT = {
				event_target:subject_3 = { save_event_target_as = subject_selected }
				country_event = { id = regentmaker.60 }
			}
		}
	}
	option = {
		name = rm.2.subject_4
		custom_tooltip = rm.2.subject_4.tooltip
		trigger = {
			check_variable = { which = rm_total_subjects value >= 4 }
		}
		hidden_effect = {
			ROOT = {
				event_target:subject_4 = { save_event_target_as = subject_selected }
				country_event = { id = regentmaker.60 }
			}
		}
	}
	option = {
		name = rm.2.subject_5
		custom_tooltip = rm.2.subject_5.tooltip
		trigger = {
			check_variable = { which = rm_total_subjects value >= 5 }
		}
		hidden_effect = {
			ROOT = {
				event_target:subject_5 = { save_event_target_as = subject_selected }
				country_event = { id = regentmaker.60 }
			}
		}
	}
	option = {
		name = rm.2.subject_6
		custom_tooltip = rm.2.subject_6.tooltip
		trigger = {
			check_variable = { which = rm_total_subjects value >= 6 }
		}
		hidden_effect = {
			ROOT = {
				event_target:subject_6 = { save_event_target_as = subject_selected }
				country_event = { id = regentmaker.60 }
			}
		}
	}
	option = {
		name = rm.2.subject_7
		custom_tooltip = rm.2.subject_7.tooltip
		trigger = {
			check_variable = { which = rm_total_subjects value >= 7 }
		}
		hidden_effect = {
			ROOT = {
				event_target:subject_7 = { save_event_target_as = subject_selected }
				country_event = { id = regentmaker.60 }
			}
		}
	}
	option = {
		name = rm.2.subject_8
		custom_tooltip = rm.2.subject_8.tooltip
		trigger = {
			check_variable = { which = rm_total_subjects value >= 8 }
		}
		hidden_effect = {
			ROOT = {
				event_target:subject_8 = { save_event_target_as = subject_selected }
				country_event = { id = regentmaker.60 }
			}
		}
	}
	option = {
		name = rm.2.subject_9
		custom_tooltip = rm.2.subject_9.tooltip
		trigger = {
			check_variable = { which = rm_total_subjects value >= 9 }
		}
		hidden_effect = {
			ROOT = {
				event_target:subject_9 = { save_event_target_as = subject_selected }
				country_event = { id = regentmaker.60 }
			}
		}
	}
	option = {
		name = rm.2.subject_10
		custom_tooltip = rm.2.subject_10.tooltip
		trigger = {
			check_variable = { which = rm_total_subjects value >= 10 }
		}
		hidden_effect = {
			ROOT = {
				event_target:subject_10 = { save_event_target_as = subject_selected }
				country_event = { id = regentmaker.60 }
			}
		}
	}
	option = {
		name = rm.2.back
		trigger = {
			check_variable = { which = rm_total_subjects value > 0 }
		}
		hidden_effect = {
			country_event = { id = regentmaker.7 }
		}
	}
}

# List Subjects - Government Selection
country_event = {
	id = regentmaker.503
	title = rm.4.name
	desc = {
		trigger = {
			check_variable = { which = rm_total_subjects value > 0 }
		}
		text = rm.4.desc
	}
	desc = {
		trigger = {
			check_variable = { which = rm_total_subjects value = 0 }
		}
		text = rm.2.desc.fail
	}
	picture = GFX_evt_board_meeting
	show_sound = event_laboratory_sound
	location = ROOT
	is_triggered_only = yes
	# No valid target
	option = {
		name = "UNFORTUNATE"
		exclusive_trigger = {
			check_variable = { which = rm_total_subjects value = 0 }
		}
	}
	# Now we show a list of the subject states to the player
	option = {
		name = rm.2.subject_1
		custom_tooltip = rm.2.subject_1.tooltip
		trigger = {
			check_variable = { which = rm_total_subjects value >= 1 }
		}
		hidden_effect = {
			ROOT = {
				event_target:subject_1 = { save_event_target_as = subject_selected }
				country_event = { id = regentmaker.70 }
			}
		}
	}
	option = {
		name = rm.2.subject_2
		custom_tooltip = rm.2.subject_2.tooltip
		trigger = {
			check_variable = { which = rm_total_subjects value >= 2 }
		}
		hidden_effect = {
			ROOT = {
				event_target:subject_2 = { save_event_target_as = subject_selected }
				country_event = { id = regentmaker.70 }
			}
		}
	}
	option = {
		name = rm.2.subject_3
		custom_tooltip = rm.2.subject_3.tooltip
		trigger = {
			check_variable = { which = rm_total_subjects value >= 3 }
		}
		hidden_effect = {
			ROOT = {
				event_target:subject_3 = { save_event_target_as = subject_selected }
				country_event = { id = regentmaker.70 }
			}
		}
	}
	option = {
		name = rm.2.subject_4
		custom_tooltip = rm.2.subject_4.tooltip
		trigger = {
			check_variable = { which = rm_total_subjects value >= 4 }
		}
		hidden_effect = {
			ROOT = {
				event_target:subject_4 = { save_event_target_as = subject_selected }
				country_event = { id = regentmaker.70 }
			}
		}
	}
	option = {
		name = rm.2.subject_5
		custom_tooltip = rm.2.subject_5.tooltip
		trigger = {
			check_variable = { which = rm_total_subjects value >= 5 }
		}
		hidden_effect = {
			ROOT = {
				event_target:subject_5 = { save_event_target_as = subject_selected }
				country_event = { id = regentmaker.70 }
			}
		}
	}
	option = {
		name = rm.2.subject_6
		custom_tooltip = rm.2.subject_6.tooltip
		trigger = {
			check_variable = { which = rm_total_subjects value >= 7 }
		}
		hidden_effect = {
			ROOT = {
				event_target:subject_6 = { save_event_target_as = subject_selected }
				country_event = { id = regentmaker.70 }
			}
		}
	}
	option = {
		name = rm.2.subject_7
		custom_tooltip = rm.2.subject_7.tooltip
		trigger = {
			check_variable = { which = rm_total_subjects value >= 7 }
		}
		hidden_effect = {
			ROOT = {
				event_target:subject_7 = { save_event_target_as = subject_selected }
				country_event = { id = regentmaker.70 }
			}
		}
	}
	option = {
		name = rm.2.subject_8
		custom_tooltip = rm.2.subject_8.tooltip
		trigger = {
			check_variable = { which = rm_total_subjects value >= 8 }
		}
		hidden_effect = {
			ROOT = {
				event_target:subject_8 = { save_event_target_as = subject_selected }
				country_event = { id = regentmaker.70 }
			}
		}
	}
	option = {
		name = rm.2.subject_9
		custom_tooltip = rm.2.subject_9.tooltip
		trigger = {
			check_variable = { which = rm_total_subjects value >= 9 }
		}
		hidden_effect = {
			ROOT = {
				event_target:subject_9 = { save_event_target_as = subject_selected }
				country_event = { id = regentmaker.70 }
			}
		}
	}
	option = {
		name = rm.2.subject_10
		custom_tooltip = rm.2.subject_10.tooltip
		trigger = {
			check_variable = { which = rm_total_subjects value >= 10 }
		}
		hidden_effect = {
			ROOT = {
				event_target:subject_10 = { save_event_target_as = subject_selected }
				country_event = { id = regentmaker.70 }
			}
		}
	}
	option = {
		name = rm.2.back
		trigger = {
			check_variable = { which = rm_total_subjects value > 0 }
		}
		hidden_effect = {
			country_event = { id = regentmaker.8 }
		}
	}
}

# "Regentmaker Ethics Selection"
country_event = {
	id = regentmaker.60
	title = regentmaker.60.name
	desc = regentmaker.60.desc
	picture = GFX_evt_arguing_senate
	show_sound = event_conversation
	location = event_target:subject_selected
	is_triggered_only = yes
	option = {
		name = "ethic_fanatic_authoritarian"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_ethic = ethic_fanatic_authoritarian }
			}
		}
		hidden_effect = {
			event_target:subject_selected = { shift_ethic = ethic_fanatic_authoritarian }
		}
	}
	option = {
		name = "ethic_authoritarian"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_ethic = ethic_authoritarian }
			}
		}
		hidden_effect = {
			event_target:subject_selected = { shift_ethic = ethic_authoritarian }
		}
	}
	option = {
		name = "ethic_fanatic_egalitarian"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_ethic = ethic_fanatic_egalitarian }
			}
		}
		hidden_effect = {
			event_target:subject_selected = { shift_ethic = ethic_fanatic_egalitarian }
		}
	}
	option = {
		name = "ethic_egalitarian"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_ethic = ethic_egalitarian }
			}
		}
		hidden_effect = {
			event_target:subject_selected = { shift_ethic = ethic_egalitarian }
		}
	}
	option = {
		name = "ethic_fanatic_xenophobe"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_ethic = ethic_fanatic_xenophobe }
			}
		}
		hidden_effect = {
			event_target:subject_selected = { shift_ethic = ethic_fanatic_xenophobe }
		}
	}
	option = {
		name = "ethic_xenophobe"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_ethic = ethic_xenophobe }
			}
		}
		hidden_effect = {
			event_target:subject_selected = { shift_ethic = ethic_xenophobe }
		}
	}
	option = {
		name = "ethic_fanatic_xenophile"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_ethic = ethic_fanatic_xenophile }
			}
		}
		hidden_effect = {
			event_target:subject_selected = { shift_ethic = ethic_fanatic_xenophile }
		}
	}
	option = {
		name = "ethic_xenophile"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_ethic = ethic_xenophile }
			}
		}
		hidden_effect = {
			event_target:subject_selected = { shift_ethic = ethic_xenophile }
		}
	}
	option = {
		name = "ethic_fanatic_militarist"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_ethic = ethic_fanatic_militarist }
			}
		}
		hidden_effect = {
			event_target:subject_selected = { shift_ethic = ethic_fanatic_militarist }
		}
	}
	option = {
		name = "ethic_militarist"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_ethic = ethic_militarist }
			}
		}
		hidden_effect = {
			event_target:subject_selected = { shift_ethic = ethic_militarist }
		}
	}
	option = {
		name = "ethic_fanatic_pacifist"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_ethic = ethic_fanatic_pacifist }
			}
		}
		hidden_effect = {
			event_target:subject_selected = { shift_ethic = ethic_fanatic_pacifist }
		}
	}
	option = {
		name = "ethic_pacifist"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_ethic = ethic_pacifist }
			}
		}
		hidden_effect = {
			event_target:subject_selected = { shift_ethic = ethic_pacifist }
		}
	}
	option = {
		name = "ethic_fanatic_spiritualist"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_ethic = ethic_fanatic_spiritualist }
			}
		}
		hidden_effect = {
			event_target:subject_selected = { shift_ethic = ethic_fanatic_spiritualist }
		}
	}
	option = {
		name = "ethic_spiritualist"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_ethic = ethic_spiritualist }
			}
		}
		hidden_effect = {
			event_target:subject_selected = { shift_ethic = ethic_spiritualist }
		}
	}
	option = {
		name = "ethic_fanatic_materialist"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_ethic = ethic_fanatic_materialist }
			}
		}
		hidden_effect = {
			event_target:subject_selected = { shift_ethic = ethic_fanatic_materialist }
		}
	}
	option = {
		name = "ethic_materialist"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_ethic = ethic_materialist }
			}
		}
		hidden_effect = {
			event_target:subject_selected = { shift_ethic = ethic_materialist }
		}
	}
	# TODO Extension compat. ?
	option = {
		name = "ethic_fanatic_socialism"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_ethic = ethic_fanatic_socialism }
			}
			has_global_flag = cultural_overhaul_active
		}
		hidden_effect = {
			event_target:subject_selected = { shift_ethic = ethic_fanatic_socialism }
		}
	}
	option = {
		name = "ethic_socialism"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_ethic = ethic_socialism }
			}
			has_global_flag = gf_veru_activated
		}
		hidden_effect = {
			event_target:subject_selected = { shift_ethic = ethic_socialism }
		}
	}
	option = {
		name = "ethic_fanatic_capitalism"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_ethic = ethic_fanatic_capitalism }
			}
			has_global_flag = gf_veru_activated
		}
		hidden_effect = {
			event_target:subject_selected = { shift_ethic = ethic_fanatic_capitalism }
		}
	}
	option = {
		name = "ethic_capitalism"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_ethic = ethic_capitalism }
			}
			has_global_flag = gf_veru_activated
		}
		hidden_effect = {
			event_target:subject_selected = { shift_ethic = ethic_capitalism }
		}
	}
	option = {
		name = rm.3.back # BACK
	}
	after = {
		hidden_effect = {
			country_event = { id = regentmaker.502 }
		}
	}
}

# Change Government (specific subject)
country_event = {
	id = regentmaker.70
	title = regentmaker.70.name
	desc = regentmaker.70.desc
	picture = GFX_evt_arguing_senate
	show_sound = event_conversation
	location = event_target:subject_selected
	is_triggered_only = yes
	option = {
		name = "auth_democratic"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_authority = auth_democratic }
			}
		}
		event_target:subject_selected = {
			clear_ethos = yes
			country_add_ethic = ethic_fanatic_egalitarian
			change_government = {
				authority = auth_democratic
				remove_invalid_civics = yes cooldown = no
				civics = {
					civic = random
					civic = random
					civic = random
				}
			}
			country_event = { id = regentmaker.30 }
		}
	}
	option = {
		name = "auth_strict_democratic"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_authority = auth_strict_democratic }
			}
			has_global_flag = gf_moreauthorities_activated
		}
		event_target:subject_selected = {
			clear_ethos = yes
			country_add_ethic = ethic_fanatic_egalitarian
			change_government = {
				authority = auth_strict_democratic
				remove_invalid_civics = yes cooldown = no
				civics = {
					civic = random
					civic = random
					civic = random
				}
			}
			country_event = { id = regentmaker.30 }
		}
	}
	option = {
		name = "auth_direct_democratic"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_authority = auth_direct_democratic }
			}
			has_global_flag = gf_veru_activated
		}
		event_target:subject_selected = {
			clear_ethos = yes
			country_add_ethic = ethic_fanatic_egalitarian
			change_government = {
				authority = auth_direct_democratic
				remove_invalid_civics = yes cooldown = no
				civics = {
					civic = random
					civic = random
					civic = random
				}
			}
			country_event = { id = regentmaker.30 }
		}
	}
	option = {
		name = "auth_democratic_dictatorship"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_authority = auth_democratic_dictatorship }
			}
			has_global_flag = gf_moreauthorities_activated
		}
		event_target:subject_selected = {
			clear_ethos = yes
			country_add_ethic = ethic_authoritarian
			change_government = {
				authority = auth_democratic_dictatorship
				remove_invalid_civics = yes
				cooldown = no
				civics = {
					civic = random
					civic = random
					civic = random
				}
			}
			country_event = { id = regentmaker.30 }
		}
	}
	option = {
		name = "auth_oligarchic"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_authority = auth_oligarchic }
			}
		}
		event_target:subject_selected = {
			clear_ethos = yes
			country_add_ethic = ethic_authoritarian
			change_government = {
				authority = auth_oligarchic
				remove_invalid_civics = yes cooldown = no
				civics = {
					civic = random
					civic = random
					civic = random
				}
			}
			country_event = { id = regentmaker.30 }
		}
	}
	option = {
		name = "auth_dictatorial"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_authority = auth_dictatorial }
			}
		}
		event_target:subject_selected = {
			clear_ethos = yes
			country_add_ethic = ethic_fanatic_authoritarian
			change_government = {
				authority = auth_dictatorial
				remove_invalid_civics = yes cooldown = no
				civics = {
					civic = random
					civic = random
					civic = random
				}
			}
			country_event = { id = regentmaker.30 }
		}
	}
	option = {
		name = "auth_imperial"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_authority = auth_imperial }
			}
		}
		event_target:subject_selected = {
			clear_ethos = yes
			country_add_ethic = ethic_fanatic_authoritarian
			change_government = {
				authority = auth_imperial
				remove_invalid_civics = yes cooldown = no
				civics = {
					civic = random
					civic = random
					civic = random
				}
			}
			country_event = { id = regentmaker.30 }
		}
	}
	option = {
		name = "auth_corporate"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_authority = auth_corporate }
			}
		}
		event_target:subject_selected = {
			clear_ethos = yes
			country_add_ethic = ethic_fanatic_capitalism
			change_government = {
				authority = auth_corporate
				remove_invalid_civics = yes cooldown = no
				civics = {
					civic = random
					civic = random
					civic = random
				}
			}
			country_event = { id = regentmaker.30 }
		}
	}
	option = {
		name = "auth_corporate_imperial"
		trigger = {
			event_target:subject_selected = {
				NOT = { has_authority = auth_corporate_imperial }
			}
			has_global_flag = gf_moreauthorities_activated
		}
		event_target:subject_selected = {
			clear_ethos = yes
			country_add_ethic = ethic_fanatic_authoritarian
			shift_ethic = ethic_fanatic_capitalism
			# shift_ethic = random seems not working
			change_government = {
				authority = auth_corporate_imperial
				remove_invalid_civics = yes cooldown = no
				civics = {
					civic = random
					civic = random
					civic = random
				}
			}
			country_event = { id = regentmaker.30 }
		}
	}
	option = {
		name = rm.3.back # BACK
	}
	after = {
		hidden_effect = {
			country_event = { id = regentmaker.503 }
		}
	}
}

# Ethic Randomizer (mainly taken from action.30)
# Using gov authority country flag for weighting ethos
country_event = {
	id = regentmaker.30
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		is_country_type = default
	}
	immediate = {
		switch = {
			trigger = has_country_flag
			auth_democratic = { country_remove_ethic	= ethic_fanatic_authoritarian country_remove_ethic	= ethic_authoritarian }
			auth_oligarchic = { country_remove_ethic	= ethic_fanatic_authoritarian country_remove_ethic	= ethic_fanatic_egalitarian }
			auth_dictatorial = { country_remove_ethic	= ethic_fanatic_egalitarian country_remove_ethic	= ethic_egalitarian }
			auth_imperial = { country_remove_ethic		= ethic_fanatic_egalitarian country_remove_ethic	= ethic_egalitarian }
			auth_corporate = { country_remove_ethic		= ethic_fanatic_authoritarian country_remove_ethic	= ethic_fanatic_egalitarian }
		}
		if = {
			limit = { has_ethic = ethic_gestalt_consciousness }
			country_remove_ethic = ethic_gestalt_consciousness
		}
		if = { limit = { num_ethics = 1 }
			random_list = {
				1 = { country_add_ethic = ethic_fanatic_materialist		modifier = { factor = 0 has_ethic = ethic_fanatic_materialist } }
				1 = { country_add_ethic = ethic_fanatic_spiritualist	modifier = { factor = 0 has_ethic = ethic_fanatic_spiritualist } }
				1 = { country_add_ethic = ethic_fanatic_militarist		modifier = { factor = 0 has_ethic = ethic_fanatic_militarist } }
				1 = { country_add_ethic = ethic_fanatic_pacifist		modifier = { factor = 0 has_ethic = ethic_fanatic_pacifist } }
				1 = { country_add_ethic = ethic_fanatic_xenophile		modifier = { factor = 0 has_ethic = ethic_fanatic_xenophile } }
				1 = { country_add_ethic = ethic_fanatic_xenophobe		modifier = { factor = 0 has_ethic = ethic_fanatic_xenophobe } }
				4 = { country_add_ethic = ethic_fanatic_egalitarian		modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_egalitarian has_country_flag = auth_dictatorial has_country_flag = auth_oligarchic has_country_flag = auth_imperial has_country_flag = auth_corporate } } }
				3 = { country_add_ethic = ethic_fanatic_authoritarian	modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_authoritarian has_country_flag = auth_democratic has_country_flag = auth_oligarchic has_country_flag = auth_corporate } } }
			}
			random_list = {
				1 = { country_add_ethic = ethic_materialist		modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_materialist has_ethic = ethic_fanatic_spiritualist		has_ethic = ethic_fanatic_materialist } } }
				1 = { country_add_ethic = ethic_spiritualist	modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_spiritualist has_ethic = ethic_fanatic_materialist		has_ethic = ethic_fanatic_spiritualist } } }
				1 = { country_add_ethic = ethic_militarist		modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_militarist has_ethic = ethic_fanatic_pacifist			has_ethic = ethic_fanatic_militarist } } }
				1 = { country_add_ethic = ethic_pacifist		modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_pacifist has_ethic = ethic_fanatic_militarist			has_ethic = ethic_fanatic_pacifist } } }
				1 = { country_add_ethic = ethic_xenophile		modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_xenophile has_ethic = ethic_fanatic_xenophobe			has_ethic = ethic_fanatic_xenophile } } }
				1 = { country_add_ethic = ethic_xenophobe		modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_xenophobe has_ethic = ethic_fanatic_xenophile			has_ethic = ethic_fanatic_xenophobe } } }
				3 = { country_add_ethic = ethic_egalitarian		modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_egalitarian has_ethic = ethic_fanatic_authoritarian	has_ethic = ethic_fanatic_egalitarian has_country_flag = auth_dictatorial has_country_flag = auth_imperial } } }
				2 = { country_add_ethic = ethic_authoritarian	modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_authoritarian has_ethic = ethic_fanatic_egalitarian	has_ethic = ethic_fanatic_authoritarian has_country_flag = auth_democratic } } }
			}
		} else_if = { limit = { num_ethics > 0 }
			random_list = {
				1 = { shift_ethic = ethic_fanatic_materialist	modifier = { factor = 0 has_ethic = ethic_fanatic_materialist } }
				1 = { shift_ethic = ethic_fanatic_spiritualist	modifier = { factor = 0 has_ethic = ethic_fanatic_spiritualist } }
				1 = { shift_ethic = ethic_fanatic_militarist	modifier = { factor = 0 has_ethic = ethic_fanatic_militarist } }
				1 = { shift_ethic = ethic_fanatic_pacifist		modifier = { factor = 0 has_ethic = ethic_fanatic_pacifist } }
				1 = { shift_ethic = ethic_fanatic_xenophile		modifier = { factor = 0 has_ethic = ethic_fanatic_xenophile } }
				1 = { shift_ethic = ethic_fanatic_xenophobe		modifier = { factor = 0 has_ethic = ethic_fanatic_xenophobe } }
				4 = { shift_ethic = ethic_fanatic_egalitarian	modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_egalitarian has_country_flag = auth_dictatorial has_country_flag = auth_oligarchic has_country_flag = auth_imperial has_country_flag = auth_corporate } } }
				3 = { shift_ethic = ethic_fanatic_authoritarian	modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_authoritarian has_country_flag = auth_democratic has_country_flag = auth_oligarchic has_country_flag = auth_corporate } } }
			}
			random_list = {
				1 = { shift_ethic = ethic_materialist	modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_materialist has_ethic = ethic_fanatic_spiritualist		has_ethic = ethic_fanatic_materialist } } }
				1 = { shift_ethic = ethic_spiritualist	modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_spiritualist has_ethic = ethic_fanatic_materialist		has_ethic = ethic_fanatic_spiritualist } } }
				1 = { shift_ethic = ethic_militarist	modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_militarist has_ethic = ethic_fanatic_pacifist			has_ethic = ethic_fanatic_militarist } } }
				1 = { shift_ethic = ethic_pacifist		modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_pacifist has_ethic = ethic_fanatic_militarist			has_ethic = ethic_fanatic_pacifist } } }
				1 = { shift_ethic = ethic_xenophile		modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_xenophile has_ethic = ethic_fanatic_xenophobe			has_ethic = ethic_fanatic_xenophile } } }
				1 = { shift_ethic = ethic_xenophobe		modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_xenophobe has_ethic = ethic_fanatic_xenophile			has_ethic = ethic_fanatic_xenophobe } } }
				3 = { shift_ethic = ethic_egalitarian	modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_egalitarian has_ethic = ethic_fanatic_authoritarian	has_ethic = ethic_fanatic_egalitarian has_country_flag = auth_dictatorial has_country_flag = auth_imperial } } }
				2 = { shift_ethic = ethic_authoritarian	modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_authoritarian has_ethic = ethic_fanatic_egalitarian	has_ethic = ethic_fanatic_authoritarian has_country_flag = auth_democratic } } }
			}
		} else = {
			random_list = {
				70 = { # fanatic and non-fanatic
					random_list = {
						1 = { country_add_ethic = ethic_fanatic_materialist }
						1 = { country_add_ethic = ethic_fanatic_spiritualist }
						1 = { country_add_ethic = ethic_fanatic_militarist }
						1 = { country_add_ethic = ethic_fanatic_pacifist }
						1 = { country_add_ethic = ethic_fanatic_xenophile }
						1 = { country_add_ethic = ethic_fanatic_xenophobe }
						4 = { country_add_ethic = ethic_fanatic_egalitarian modifier = { factor = 0 OR = { has_country_flag = auth_dictatorial has_country_flag = auth_oligarchic has_country_flag = auth_imperial has_country_flag = auth_corporate } } }
						3 = { country_add_ethic = ethic_fanatic_authoritarian modifier = { factor = 0 OR = { has_country_flag = auth_democratic has_country_flag = auth_oligarchic has_country_flag = auth_corporate } } }
					}
					random_list = {
						1 = { country_add_ethic = ethic_materialist		modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_materialist	has_ethic = ethic_fanatic_spiritualist } } }
						1 = { country_add_ethic = ethic_spiritualist	modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_spiritualist	has_ethic = ethic_fanatic_materialist } } }
						1 = { country_add_ethic = ethic_militarist		modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_militarist		has_ethic = ethic_fanatic_pacifist } } }
						1 = { country_add_ethic = ethic_pacifist		modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_pacifist		has_ethic = ethic_fanatic_militarist } } }
						1 = { country_add_ethic = ethic_xenophile		modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_xenophile		has_ethic = ethic_fanatic_xenophobe } } }
						1 = { country_add_ethic = ethic_xenophobe		modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_xenophobe		has_ethic = ethic_fanatic_xenophile } } }
						3 = { country_add_ethic = ethic_egalitarian		modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_egalitarian	has_ethic = ethic_fanatic_authoritarian has_country_flag = auth_dictatorial has_country_flag = auth_imperial } } }
						2 = { country_add_ethic = ethic_authoritarian	modifier = { factor = 0 OR = { has_ethic = ethic_fanatic_authoritarian	has_ethic = ethic_fanatic_egalitarian has_country_flag = auth_democratic } } }
					}
				}
				30 = { # only non-fanatic
					random_list = {
						1 = { country_add_ethic = ethic_materialist }
						1 = { country_add_ethic = ethic_spiritualist }
						1 = { country_add_ethic = ethic_militarist }
						1 = { country_add_ethic = ethic_pacifist }
						1 = { country_add_ethic = ethic_xenophile }
						1 = { country_add_ethic = ethic_xenophobe }
						3 = { country_add_ethic = ethic_egalitarian modifier = { factor = 0 OR = { has_country_flag = auth_dictatorial has_country_flag = auth_imperial } } }
						2 = { country_add_ethic = ethic_authoritarian modifier = { factor = 0 has_country_flag = auth_democratic } }
					}
					random_list = {
						1 = { country_add_ethic = ethic_materialist		modifier = { factor = 0 OR = { has_ethic = ethic_materialist	has_ethic = ethic_spiritualist } } }
						1 = { country_add_ethic = ethic_spiritualist	modifier = { factor = 0 OR = { has_ethic = ethic_spiritualist	has_ethic = ethic_materialist } } }
						1 = { country_add_ethic = ethic_militarist		modifier = { factor = 0 OR = { has_ethic = ethic_militarist		has_ethic = ethic_pacifist } } }
						1 = { country_add_ethic = ethic_pacifist		modifier = { factor = 0 OR = { has_ethic = ethic_pacifist		has_ethic = ethic_militarist } } }
						1 = { country_add_ethic = ethic_xenophile		modifier = { factor = 0 OR = { has_ethic = ethic_xenophile		has_ethic = ethic_xenophobe } } }
						1 = { country_add_ethic = ethic_xenophobe		modifier = { factor = 0 OR = { has_ethic = ethic_xenophobe		has_ethic = ethic_xenophile } } }
						3 = { country_add_ethic = ethic_egalitarian		modifier = { factor = 0 OR = { has_ethic = ethic_egalitarian	has_ethic = ethic_authoritarian has_country_flag = auth_dictatorial has_country_flag = auth_imperial } } }
						2 = { country_add_ethic = ethic_authoritarian	modifier = { factor = 0 OR = { has_ethic = ethic_authoritarian	has_ethic = ethic_egalitarian has_country_flag = auth_democratic } } }
					}
					random_list = {
						1 = { country_add_ethic = ethic_materialist		modifier = { factor = 0 OR = { has_ethic = ethic_materialist	has_ethic = ethic_spiritualist } } }
						1 = { country_add_ethic = ethic_spiritualist	modifier = { factor = 0 OR = { has_ethic = ethic_spiritualist	has_ethic = ethic_materialist } } }
						1 = { country_add_ethic = ethic_militarist		modifier = { factor = 0 OR = { has_ethic = ethic_militarist		has_ethic = ethic_pacifist } } }
						1 = { country_add_ethic = ethic_pacifist		modifier = { factor = 0 OR = { has_ethic = ethic_pacifist		has_ethic = ethic_militarist } } }
						1 = { country_add_ethic = ethic_xenophile		modifier = { factor = 0 OR = { has_ethic = ethic_xenophile		has_ethic = ethic_xenophobe } } }
						1 = { country_add_ethic = ethic_xenophobe		modifier = { factor = 0 OR = { has_ethic = ethic_xenophobe		has_ethic = ethic_xenophile } } }
						3 = { country_add_ethic = ethic_egalitarian		modifier = { factor = 0 OR = { has_ethic = ethic_egalitarian	has_ethic = ethic_authoritarian has_country_flag = auth_dictatorial has_country_flag = auth_imperial } } }
						2 = { country_add_ethic = ethic_authoritarian	modifier = { factor = 0 OR = { has_ethic = ethic_authoritarian	has_ethic = ethic_egalitarian has_country_flag = auth_democratic } } }
					}
				}
			}
		}
	}
}
