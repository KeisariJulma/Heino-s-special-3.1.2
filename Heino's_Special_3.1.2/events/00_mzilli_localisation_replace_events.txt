namespace = distar

ship_event = {
	id = distar.156
	title = "distar.156.name"
	desc = {
		trigger = {
			owner = { NOT = { has_authority = auth_machine_intelligence } }
		}
		text = "distar.156.desc"
	}
	desc = {
		trigger = {
			owner = { has_authority = auth_machine_intelligence }
		}
		text = "distar.156.desc.machi"
	}
	picture = GFX_evt_space_debris
	show_sound = event_construction
	location = event_target:repaired_warform

	is_triggered_only = yes

	immediate = {
		FROMFROM = { save_global_event_target_as = warform_planet }
		save_event_target_as = research_ship
		create_country = {
			name = "NAME_S8751"
			type = faction
			auto_delete = yes
			flag = {
    		    		icon = {
    		        		category = "special"
    		        		file = "unknown.dds"
    		    		}
    		    		background = {
    		        		category = "backgrounds"
    		        		file = "00_solid.dds"
    		    		}
    		    		colors = {
    		        		"green"
    		        		"green"
    		        		"null"
    		        		"null"
    		    		}
    			}
    			effect = {
    				save_event_target_as = warform_country
    			}
    		}
	    	event_target:warform_country = {
    			set_faction_hostility = {
				target = root.owner
				set_hostile = no
				set_neutral = no
				set_friendly = yes
			}
			IF = {
				LIMIT = { host_has_dlc = "Synthetic Dawn Story Pack" }
				create_species = {
					name = "NAME_S8751"
					class = ROBOT
					portrait = sd_rep_robot
					namelist = "AI"
					traits = {
						trait = trait_mechanical
						trait = random_traits
					}
					effect = {
						save_event_target_as = warform_species
					}
				}
			}
			ELSE = {
				create_species = {
					name = "NAME_S8751"
					class = ROBOT
					portrait = default_robot
					namelist = "AI"
					traits = {
						trait = trait_mechanical
						trait = random_traits
					}
					effect = {
						save_event_target_as = warform_species
					}
				}
			}
			create_leader = {
				class = admiral
				species = event_target:warform_species
				name = "NAME_S8751"
				skill = 3
				event_leader = yes
			}
			last_created_leader = {
				save_event_target_as = warform_leader
			}
			create_fleet = {
				name = "NAME_S8751"
				effect = {
					set_owner = prev
					create_ship = {
						name = "NAME_S8751"
						design = "NAME_S8751"
						prefix = no
						upgradable = no
					}
					set_location = {
						target = root
						distance = 10
						angle = random
					}
					set_fleet_stance = passive
					add_modifier = { modifier = "big_friendly_warform_power" days = -1 }
					assign_leader = event_target:warform_leader
					set_fleet_flag = repaired_warform
					save_event_target_as = repaired_warform
				}
				settings = {
					can_upgrade = yes
					can_change_composition = no
					can_change_leader = no
					uses_naval_capacity = no
					spawn_debris = yes
				}
			}
		}
	}

	option = {
		name = ONSCREEN
		hidden_effect = {
			owner = {
				country_event = { id = distar.158 }
			}
		}
	}
}